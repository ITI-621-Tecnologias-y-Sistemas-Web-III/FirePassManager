<!doctype html>
<html lang="en">
<head>
	<!-- Visualization environment -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<!-- Control environment web application -->
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta value="no-cache, no-store, must-revalidate" name="no-chache">

    <!-- Application icon -->
    <link rel="icon" type="image/svg+xml" href="img/logo.svg">

	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
		  rel="stylesheet"
		  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
		  crossorigin="anonymous">

	<!-- Font awesome decoration -->
	<script src="https://kit.fontawesome.com/2c7bfef965.js" crossorigin="anonymous"></script>

	<!-- Custom decoration -->
	<title>Pass Manager</title>
	<link rel="stylesheet" href="css/styles.css">

	<!-- References Firebase libraries -->
	<!-- update the version number as needed -->
	<script src="/__/firebase/12.5.0/firebase-app-compat.js"></script>
	<script src="/__/firebase/12.5.0/firebase-auth-compat.js"></script>
	<script src="/__/firebase/12.5.0/firebase-database-compat.js"></script>
	<script src="/__/firebase/12.5.0/firebase-firestore-compat.js"></script>
	<script src="/__/firebase/12.5.0/firebase-storage-compat.js"></script>

	<!-- initilized firebase object -->
	<script src="/__/firebase/init.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</head>
<body>
	<header class="header row">
		<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top" style="justify-content: flex-end;">
			<div class="container-fluid">
				<div class="collapse navbar-collapse" id="navbarNavDropdown">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link" aria-current="page" onclick="exit()">Cerrar sesión</a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
	</header>
	<div class="main-container">
		<div class="header">
			<div class="row align-items-center">
				<div class="col-md-6">
					<h1><a href="index.html"><img src="img/logo.svg" alt="SecurePass Logo" width="80" height="80"></a> Administrador de contraseñas</h1>
					<p class="text-muted mb-0">Gestiona tus credenciales de forma segura</p>
				</div>
				<div class="col-md-6 text-end">
					<button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addPasswordModal">
						<i class="fas fa-plus"></i> Agregar contraseña
					</button>
				</div>
			</div>
		</div>

		<div class="filter-section">
			<div class="row">
				<div class="col-md-6">
					<input type="text" class="form-control" id="searchInput" placeholder="Buscar...">
				</div>
				<div class="col-md-3">
					<select class="form-select" id="categoryFilter">
						<option value="">Todas las categorías</option>
					</select>
				</div>
				<div class="col-md-3">
					<select class="form-select" id="statusFilter">
						<option value="">Todos los estados</option>
						<option value="safe">Vigentes</option>
						<option value="expiring">Por vencer</option>
						<option value="expired">Vencidos</option>
					</select>
				</div>
			</div>
		</div>

		<div id="passwordsList"></div>

		<div class="text-center mt-4" id="emptyState" style="display: none;">
			<i class="fas fa-key fa-4x text-muted mb-3"></i>
			<h4 class="text-muted">No hay contraseñas guardadas</h4>
			<p>Comienza agregando tu primera contraseña</p>
		</div>
	</div>

    <!-- Modal Agregar/Editar Contraseña -->
    <div class="modal fade" id="addPasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Agregar Contraseña</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="passwordForm">
                        <input type="hidden" id="passwordId">
                        <div class="mb-3">
                            <label class="form-label">Sitio Web / Referencia *</label>
                            <input type="text" class="form-control" id="website" required placeholder="ej. Gmail, Facebook, Banco">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Usuario / Email</label>
                            <input type="text" class="form-control" id="username" placeholder="usuario@email.com">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Contraseña *</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePasswordVisibility()">
                                    <i class="fas fa-eye" id="toggleIcon"></i>
                                </button>
                                <button class="btn btn-outline-primary" type="button" onclick="generatePassword()">
                                    <i class="fas fa-random"></i> Generar
                                </button>
                            </div>
                        </div>
						<div class="mt-2" id="passwordStrength" style="display: none;">
							<div class="progress">
								<div id="passwordStrengthBar" class="progress-bar" role="progressbar"
									style="width: 0%">
								</div>
							</div>
							<small id="passwordStrengthText" class="form-text text-muted"></small>
						</div>
                        <div class="mb-3">
                            <label class="form-label">Categoría *</label>
                            <input type="text" class="form-control" id="category" required placeholder="ej. Redes Sociales, Banco, Email" list="categoryList">
                            <datalist id="categoryList"></datalist>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fecha de Vencimiento</label>
                            <input type="date" class="form-control" id="expiryDate">
                            <small class="text-muted">Dejar en blanco si no aplica</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Notas</label>
                            <textarea class="form-control" id="notes" rows="2" placeholder="Información adicional..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="savePassword()">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Compartir -->
    <div class="modal fade" id="shareModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Compartir Contraseña</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Compartir: <strong id="shareWebsite"></strong></p>
                    <div class="mb-3">
                        <label class="form-label">Email del destinatario</label>
                        <input type="email" class="form-control" id="shareEmail" placeholder="usuario@email.com">
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i> Compartir contraseñas puede ser inseguro. Asegúrate de confiar en el destinatario.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="confirmShare()">Compartir</button>
                </div>
            </div>
        </div>
    </div>
	<!-- Modal Clave Maestra -->
    <div class="modal fade" id="masterPasswordModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="masterModalTitle">Clave maestra</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="masterModalDescription" class="mb-3"></p>
                    <div class="mb-3">
                        <label class="form-label">Clave maestra</label>
                        <input type="password" class="form-control" id="masterPasswordInput">
                    </div>
                    <div class="mb-3" id="masterConfirmGroup">
                        <label class="form-label">Confirmar clave maestra</label>
                        <input type="password" class="form-control" id="masterPasswordConfirmInput">
                    </div>
                    <small class="text-muted">
                        No compartas esta clave con nadie. Se usará solo para mostrar tus contraseñas.
                    </small>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="submitMasterPassword()">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

	<footer class="row">

	</footer>
	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
			crossorigin="anonymous"></script>
	
	<script src="js/passmanagerscripts.js"></script>
</body>
</html>